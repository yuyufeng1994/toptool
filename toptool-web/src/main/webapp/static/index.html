<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>最工具</title>
    <meta name="keyword" content="最工具,JSON格式转化">
    <meta name="description" content="最工具，提供各种常用的工具">
    <link rel="shortcut icon" href=" image/favicon.ico"/>
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap-theme.min.css">
</head>
<body class="container">
<h3>在线JSON格式转化</h3>
<div class="row">
    <div class="col-md-12">
        <div class="form-group">
            <textarea id="input-area" class="form-control" rows="20"></textarea>
        </div>
        <div class="form-group">
            <div class="btn-group" role="group" aria-label="...">
                <button type="button" class="btn btn-danger" onclick="jsonCheck()">校验</button>
                <button type="button" class="btn btn-default" onclick="jsonClear()">清空</button>
            </div>
        </div>
        <div class="form-group">
            <div class="alert  alert-info" id="alert-box">
                <strong id="alert-type">提示!</strong>
                <ii id="alert-info">请输入您要格式化JSON的字符串</ii>
            </div>
        </div>
    </div>
</div>
<p align="center">@最工具 2018<a href="http://www.miitbeian.gov.cn/" target="_blank"> 浙ICP备17023003号-2</a></p>
</body>
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<script>
    function jsonCheck() {
        $("#alert-box").removeClass("alert-info");
        var jsonString = $("#input-area").val()
        try {
            var jsonObj = formatJson(jsonString)
            $("#input-area").val(jsonObj)
            $("#alert-box").removeClass("alert-danger").addClass("alert-success")
            $("#alert-type").text("成功！")
            $("#alert-info").text("")
        } catch (err) {
            $("#alert-box").removeClass("alert-success").addClass("alert-danger")
            $("#alert-type").text("失败！")
            $("#alert-info").text(err)
        }

    }

    function jsonClear() {
        $("#alert-box").removeClass("alert-danger").removeClass("alert-success").addClass("alert-info")
        $("#alert-type").text("提示！")
        $("#alert-info").text("请输入您要格式化JSON的字符串")
    }

    var formatJson = function (json, options) {
        var reg = null,
            formatted = '',
            pad = 0,
            PADDING = '    '; // one can also use '\t' or a different number of spaces
        // optional settings
        options = options || {};
        // remove newline where '{' or '[' follows ':'
        options.newlineAfterColonIfBeforeBraceOrBracket = (options.newlineAfterColonIfBeforeBraceOrBracket === true) ? true : false;
        // use a space after a colon
        options.spaceAfterColon = (options.spaceAfterColon === false) ? false : true;

        // begin formatting...

        // make sure we start with the JSON as a string
        if (typeof json !== 'string') {
            json = JSON.stringify(json);
        }
        // parse and stringify in order to remove extra whitespace
        json = JSON.parse(json);
        json = JSON.stringify(json);

        // add newline before and after curly braces
        reg = /([\{\}])/g;
        json = json.replace(reg, '\r\n$1\r\n');

        // add newline before and after square brackets
        reg = /([\[\]])/g;
        json = json.replace(reg, '\r\n$1\r\n');

        // add newline after comma
        reg = /(\,)/g;
        json = json.replace(reg, '$1\r\n');

        // remove multiple newlines
        reg = /(\r\n\r\n)/g;
        json = json.replace(reg, '\r\n');

        // remove newlines before commas
        reg = /\r\n\,/g;
        json = json.replace(reg, ',');

        // optional formatting...
        if (!options.newlineAfterColonIfBeforeBraceOrBracket) {
            reg = /\:\r\n\{/g;
            json = json.replace(reg, ':{');
            reg = /\:\r\n\[/g;
            json = json.replace(reg, ':[');
        }
        if (options.spaceAfterColon) {
            reg = /\:/g;
            json = json.replace(reg, ': ');
        }

        $.each(json.split('\r\n'), function (index, node) {
            var i = 0,
                indent = 0,
                padding = '';

            if (node.match(/\{$/) || node.match(/\[$/)) {
                indent = 1;
            } else if (node.match(/\}/) || node.match(/\]/)) {
                if (pad !== 0) {
                    pad -= 1;
                }
            } else {
                indent = 0;
            }

            for (i = 0; i < pad; i++) {
                padding += PADDING;
            }

            formatted += padding + node + '\r\n';
            pad += indent;
        });

        return formatted;
    };
</script>
</html>